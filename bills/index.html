<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Legislative Tracker</title>

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    background:#f4f6f9;
}

/* -------------------
   BILL CARDS
------------------- */

#billContainer{
    max-width:1100px;
    margin:40px auto;
    padding:0 20px;
}

.bill-card{
    background:#fff;
    padding:20px;
    margin-bottom:15px;
    border-radius:8px;
    cursor:pointer;
    transition:0.2s;
    border-left:5px solid #1b3a6f;
}

.bill-card:hover{
    transform:translateY(-3px);
    box-shadow:0 6px 18px rgba(0,0,0,0.1);
}

.bill-number{
    font-weight:bold;
    font-size:18px;
    color:#1b3a6f;
}

.bill-title{
    font-size:16px;
    margin-top:4px;
}

/* -------------------
   DETAIL VIEW
------------------- */

#detailView{
    display:none;
    max-width:1100px;
    margin:40px auto;
    padding:0 20px;
}

.detail-card{
    background:#fff;
    padding:30px;
    border-radius:10px;
    box-shadow:0 8px 25px rgba(0,0,0,0.1);
}

.detail-header{
    font-size:24px;
    font-weight:bold;
    margin-bottom:5px;
}

.detail-subheader{
    color:#555;
    margin-bottom:20px;
}

.field{
    margin-bottom:12px;
}

.field-title{
    font-weight:bold;
    display:inline-block;
    width:180px;
    color:#1b3a6f;
}

.pdf-links a{
    display:block;
    margin-bottom:5px;
    text-decoration:none;
    color:#0056b3;
}

.pdf-links a:hover{
    text-decoration:underline;
}

/* -------------------
   TRACKER BAR
------------------- */

.tracker-bar{
    display:flex;
    justify-content:space-between;
    margin:30px 0 10px 0;
    position:relative;
}

.tracker-bar::before{
    content:"";
    position:absolute;
    top:18px;
    left:0;
    right:0;
    height:4px;
    background:#ddd;
    z-index:0;
}

.tracker-step{
    position:relative;
    z-index:1;
    text-align:center;
    width:14%;
}

.tracker-circle{
    width:36px;
    height:36px;
    border-radius:50%;
    background:#ccc;
    margin:0 auto 8px auto;
    transition:0.4s;
}

.tracker-step.active .tracker-circle{
    background:#1b3a6f;
}

.tracker-step.complete .tracker-circle{
    background:#2e8b57;
}

.tracker-label{
    font-size:12px;
}

/* -------------------
   TIMELINE
------------------- */

.timeline{
    margin-top:30px;
    border-left:3px solid #1b3a6f;
    padding-left:30px;
}

.timeline-item{
    position:relative;
    margin-bottom:25px;
}

.timeline-dot{
    position:absolute;
    left:-39px;
    top:4px;
    width:18px;
    height:18px;
    border-radius:50%;
    background:#999;
}

.timeline-item.latest .timeline-dot{
    background:#d9534f;
    transform:scale(1.3);
}

.timeline-text{
    font-size:14px;
}

.legend{
    font-size:12px;
    margin-top:5px;
    color:#555;
}

.back-button{
    margin-bottom:20px;
    display:inline-block;
    cursor:pointer;
    color:#0056b3;
}
</style>
</head>
<body>

<div id="billContainer"></div>

<div id="detailView">
    <div class="back-button" onclick="closeDetail()">← Back to Bills</div>
    <div class="detail-card" id="detailContent"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

<script>
const CSV_URL = "bills.csv"; // adjust path

let billsData = [];

Papa.parse(CSV_URL,{
    download:true,
    header:true,
    complete:function(results){
        billsData = results.data;
        renderBills();
        openFromHash();
    }
});

function renderBills(){
    const container = document.getElementById("billContainer");
    container.innerHTML="";

    billsData.forEach(bill=>{
        if(!bill["A"]) return;

        const card = document.createElement("div");
        card.className="bill-card";

        card.innerHTML=`
            <div class="bill-number">${bill["A"]}</div>
            <div class="bill-title">${bill["Name"] || ""}</div>
        `;

        card.onclick = () => {
            const hash = bill["A"].toLowerCase().replace(/\s/g,"");
            window.location.hash = hash;
        };

        container.appendChild(card);
    });
}

function openFromHash(){
    const hash = window.location.hash.replace("#","");
    if(!hash) return;

    const bill = billsData.find(b =>
        b["A"] &&
        b["A"].toLowerCase().replace(/\s/g,"") === hash
    );

    if(bill) openDetail(bill);
}

window.addEventListener("hashchange",openFromHash);

function openDetail(bill){

    document.getElementById("billContainer").style.display="none";
    document.getElementById("detailView").style.display="block";

    const detail = document.getElementById("detailContent");

    const status = bill["Status"] || "";
    const introChamber = bill["IntroChamber"] || "Senate";

    const trackerSteps = [
        "Introduced",
        introChamber==="Senate"?"Passed Senate":"Passed House",
        introChamber==="Senate"?"Passed House":"Passed Senate",
        "Awaiting Governor",
        "Enacted"
    ];

    const currentIndex = getTrackerIndex(status);

    const trackerHTML = trackerSteps.map((step,i)=>{
        let cls="";
        if(i<currentIndex) cls="complete";
        else if(i===currentIndex) cls="active";

        return `
        <div class="tracker-step ${cls}">
            <div class="tracker-circle"></div>
            <div class="tracker-label">${step}</div>
        </div>`;
    }).join("");

    const timelineHTML = generateTimeline(bill);

    const pa = (status==="Enacted" || status==="Repealed") && bill["B"]
        ? `${bill["B"]} | `
        : "";

    detail.innerHTML=`
        <div class="detail-header">${pa}${bill["A"]}</div>
        <div class="detail-subheader">${bill["Name"] || ""}</div>

        <div class="field">
            <span class="field-title">Tracker:</span>
            ${status}
        </div>

        <div class="field">
            <span class="field-title">Sponsors:</span>
            ${bill["Sponsors"] || "N/A"}
        </div>

        <div class="field pdf-links">
            <span class="field-title">Documents:</span>
            ${bill["IntroducedPDF"] ? `<a href="${bill["IntroducedPDF"]}" target="_blank">Introduced Bill.pdf</a>` : ""}
            ${bill["EnrolledPDF"] ? `<a href="${bill["EnrolledPDF"]}" target="_blank">Enrolled Bill.pdf</a>` : ""}
        </div>

        <div class="tracker-bar">${trackerHTML}</div>

        <div class="legend">
            SENATE ACTION IS IN ALL CAPS · house action is in lowercase
        </div>

        <div class="timeline">
            ${timelineHTML}
        </div>
    `;
}

function closeDetail(){
    window.location.hash="";
    document.getElementById("detailView").style.display="none";
    document.getElementById("billContainer").style.display="block";
}

function getTrackerIndex(status){
    switch(status){
        case "Introduced": return 0;
        case "Second Chamber": return 2;
        case "Awaiting Governor": return 3;
        case "Enacted": return 4;
        default: return 1;
    }
}

function generateTimeline(bill){

    const actions = (bill["Timeline"] || "").split("|");
    let html="";

    actions.forEach((a,i)=>{
        if(!a.trim()) return;

        const latest = i===actions.length-1 ? "latest" : "";

        html+=`
        <div class="timeline-item ${latest}">
            <div class="timeline-dot"></div>
            <div class="timeline-text">${formatChamber(a)}</div>
        </div>`;
    });

    return html;
}

function formatChamber(text){
    if(text.toLowerCase().includes("senate"))
        return text.toUpperCase();
    if(text.toLowerCase().includes("house"))
        return text.toLowerCase();
    return text;
}
</script>

</body>
</html>
