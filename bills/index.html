<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legislative Bills</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
:root {
    --primary:#0b3c5d;
    --secondary:#1d6fa5;
    --accent:#e0b400;
    --light:#f4f6f8;
    --dark:#1a1a1a;
    --muted:#6b7280;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI",Arial,sans-serif}
body{background:var(--light);color:var(--dark)}

header{
    background:var(--primary);
    color:#fff;
    padding:1rem 2rem;
}
header .logo{font-size:1.4rem;font-weight:700}

.hero{
    padding:4rem 2rem;
    text-align:center;
    background:linear-gradient(135deg,var(--primary),var(--secondary));
    color:#fff;
}
.hero h1{font-size:2.5rem;margin-bottom:0.5rem}

.filter-bar{
    max-width:1200px;
    margin:2rem auto;
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
}
.filter-bar input,
.filter-bar select{
    padding:10px 14px;
    border-radius:8px;
    border:1px solid #ccc;
    min-width:180px;
}

.results-wrapper{
    max-width:1000px;
    margin:0 auto 4rem auto;
    padding:0 1rem;
}

.results-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:1.5rem;
    font-weight:600;
    color:var(--primary);
}

.bill-row{
    background:#fff;
    padding:1.5rem;
    border-radius:14px;
    margin-bottom:1.2rem;
    box-shadow:0 8px 24px rgba(0,0,0,0.06);
    cursor:pointer;
    transition:all 0.2s ease;
}
.bill-row:hover{
    transform:translateY(-3px);
    box-shadow:0 12px 32px rgba(0,0,0,0.12);
}

.bill-top{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:0.5rem;
}

.bill-id{
    font-weight:700;
    font-size:1.1rem;
    color:var(--primary);
}

.badge{
    padding:4px 10px;
    border-radius:999px;
    font-size:12px;
    font-weight:600;
    background:var(--secondary);
    color:#fff;
}

.bill-title{
    font-size:1rem;
    font-weight:600;
    margin-bottom:0.4rem;
}

.bill-desc{
    font-size:0.9rem;
    color:var(--muted);
}

.meta-row{
    margin-top:0.8rem;
    font-size:0.85rem;
    color:var(--secondary);
}

/* === FULLSCREEN DETAIL PANEL === */
.drawer{
    position:fixed;
    bottom:-100%;
    left:0;
    width:100%;
    height:90%;
    background:#fff;
    border-top-left-radius:24px;
    border-top-right-radius:24px;
    box-shadow:0 -10px 40px rgba(0,0,0,0.2);
    transition:bottom 0.4s ease;
    padding:2rem;
    overflow-y:auto;
    z-index:1000;
}
.drawer.open{ bottom:0 }

.drawer-close{
    position:absolute;
    top:18px;
    right:24px;
    font-size:22px;
    cursor:pointer;
    font-weight:700;
}

/* HEADER */
.detail-header{
    margin-bottom:1.5rem;
}
.detail-id{
    font-size:1.4rem;
    font-weight:700;
    color:var(--primary);
}
.detail-title{
    font-size:1.1rem;
    margin-top:6px;
    font-weight:600;
}

/* PROGRESS BAR */
.progress-container{
    margin:1.5rem 0 2rem 0;
}
.progress-track{
    width:100%;
    height:10px;
    background:#e5e7eb;
    border-radius:999px;
    overflow:hidden;
}
.progress-fill{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,var(--secondary),var(--accent));
    transition:width 0.8s ease;
}

/* TIMELINE */
.timeline{
    position:relative;
    margin-top:1rem;
    padding-left:30px;
}
.timeline::before{
    content:"";
    position:absolute;
    left:10px;
    top:0;
    width:3px;
    height:100%;
    background:#e5e7eb;
}

.timeline-item{
    position:relative;
    margin-bottom:20px;
    padding-left:15px;
    font-size:0.95rem;
}

.timeline-item::before{
    content:"";
    position:absolute;
    left:-6px;
    top:4px;
    width:14px;
    height:14px;
    border-radius:50%;
    background:#ccc;
    transition:all 0.3s ease;
}

.timeline-item.active::before{
    background:var(--secondary);
    box-shadow:0 0 0 4px rgba(29,111,165,0.2);
}

.timeline-date{
    font-size:0.8rem;
    color:var(--muted);
    margin-bottom:3px;
}

.skeleton{
    background:linear-gradient(
        90deg,
        #e5e7eb 25%,
        #f3f4f6 50%,
        #e5e7eb 75%
    );
    background-size:200% 100%;
    animation:shimmer 1.4s infinite;
    border-radius:8px;
}
@keyframes shimmer{
    0%{background-position:200% 0}
    100%{background-position:-200% 0}
}
.skel-card{
    height:120px;
    margin-bottom:1rem;
}

footer{
    background:var(--primary);
    color:#fff;
    padding:2rem;
    text-align:center;
}
</style>
</head>

<body>

<header>
  <div class="logo">Michigan Legislature</div>
</header>

<section class="hero">
  <h1>Legislative Bills</h1>
  <p>Search and explore legislation introduced in the Michigan Legislature.</p>
</section>

<div class="filter-bar">
  <input id="search" placeholder="Search bills..." oninput="applyFilters()">
  <select id="chamberFilter" onchange="applyFilters()">
    <option value="">All Chambers</option>
    <option value="House">House</option>
    <option value="Senate">Senate</option>
  </select>
  <select id="statusFilter" onchange="applyFilters()">
    <option value="">All Statuses</option>
  </select>
</div>

<div class="results-wrapper">
  <div class="results-header">
      <div id="resultCount">Loading...</div>
  </div>
  <div id="results"></div>
</div>

<div id="drawer" class="drawer"></div>

<footer>© 2026 Michigan Legislature</footer>

<script>
let billsData=[];
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ31EfUU7mCQYrcQAhNTKXey6ep6f6rACOykAkPa2FIfQtAN3iRgPxumI-3AdcyYKZUVoIpuI0NDnJL/pub?gid=0&single=true&output=csv";

document.addEventListener("DOMContentLoaded",()=>{
    showSkeleton();
    Papa.parse(CSV_URL,{
        download:true,
        header:true,
        skipEmptyLines:true,
        complete:res=>{
            billsData=res.data.filter(b=>b["Bill No"]);
            populateStatusFilter();
            renderResults(billsData);
        }
    });
});

function showSkeleton(){
    const container=document.getElementById("results");
    container.innerHTML="";
    for(let i=0;i<6;i++){
        const div=document.createElement("div");
        div.className="skeleton skel-card";
        container.appendChild(div);
    }
}

function populateStatusFilter(){
    const statuses=[...new Set(billsData.map(b=>b["Status"]).filter(Boolean))];
    const select=document.getElementById("statusFilter");
    statuses.forEach(s=>{
        const opt=document.createElement("option");
        opt.value=s;
        opt.textContent=s;
        select.appendChild(opt);
    });
}

function applyFilters(){
    const q=document.getElementById("search").value.toLowerCase();
    const chamber=document.getElementById("chamberFilter").value;
    const status=document.getElementById("statusFilter").value;

    const filtered=billsData.filter(b=>{
        const text=(b["Name"]+b["Description"]+b["Bill No"]).toLowerCase();
        return (!q||text.includes(q)) &&
               (!chamber||b["Intro Chamber"]===chamber) &&
               (!status||b["Status"]===status);
    });

    renderResults(filtered);
}

function renderResults(data){
    const container=document.getElementById("results");
    container.innerHTML="";
    document.getElementById("resultCount").innerText=`${data.length} Bills`;

    if(!data.length){
        container.innerHTML="<p>No bills found.</p>";
        return;
    }

    data.forEach((bill,index)=>{
        const row=document.createElement("div");
        row.className="bill-row";
        row.onclick=()=>openDrawer(bill);
        row.innerHTML=`
            <div class="bill-top">
                <div class="bill-id">${bill["Bill No"]}</div>
                <div class="badge">${bill["Status"]||"—"}</div>
            </div>
            <div class="bill-title">${bill["Name"]||"Untitled"}</div>
            <div class="bill-desc">${bill["Description"]||""}</div>
            <div class="meta-row">Originating Chamber: ${bill["Intro Chamber"]||"—"}</div>
        `;
        container.appendChild(row);
    });
}

function openDrawer(bill){

    const drawer=document.getElementById("drawer");

    const historyItems=(bill["History"]||"")
        .split("|")
        .filter(h=>h.trim()!=="")

    const progressPercent=getProgressPercent(bill["Status"]);

    drawer.innerHTML=`
        <div class="drawer-close" onclick="closeDrawer()">✕</div>

        <div class="detail-header">
            <div class="detail-id">${bill["Bill No"]}</div>
            <div class="detail-title">${bill["Name"]||"Untitled"}</div>
        </div>

        <div><strong>Status:</strong> ${bill["Status"]||"—"}</div>
        <div><strong>Originating Chamber:</strong> ${bill["Intro Chamber"]||"—"}</div>
        <div><strong>Sponsors:</strong> ${bill["Sponsors"]||"—"}</div>

        <div class="progress-container">
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <h3>Legislative Timeline</h3>
        <div class="timeline">
            ${
                historyItems.length
                ? historyItems.map((item,i)=>`
                    <div class="timeline-item ${i===historyItems.length-1?"active":""}">
                        <div>${item.trim()}</div>
                    </div>
                `).join("")
                : `<div>No history available.</div>`
            }
        </div>
    `;

    drawer.classList.add("open");

    setTimeout(()=>{
        document.getElementById("progressFill").style.width=progressPercent+"%";
    },100);
}

function closeDrawer(){
    document.getElementById("drawer").classList.remove("open");
}

</script>

</body>
</html>
