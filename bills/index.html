<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legislative Bills</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
:root{
    --primary:#0b3c5d;
    --secondary:#1d6fa5;
    --accent:#e0b400;
    --light:#f4f6f8;
    --dark:#1a1a1a;
    --muted:#6b7280;
    --success:#16a34a;
    --danger:#dc2626;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI",Arial,sans-serif}
body{background:var(--light);color:var(--dark);line-height:1.6}

/* HEADER */
header{
    background:linear-gradient(135deg,var(--primary),var(--secondary));
    color:#fff;
    padding:1.25rem 2rem;
}
.header-inner{
    max-width:1200px;margin:auto;
    display:flex;justify-content:space-between;align-items:center;
}
.logo{font-size:1.6rem;font-weight:700}
nav a{
    color:#ffffffcc;text-decoration:none;
    margin-left:1.5rem;font-weight:500;
}
nav a.active{
    color:#fff;font-weight:700;
    border-bottom:3px solid var(--accent);
    padding-bottom:6px;
}

/* HERO */
.hero{
    background:linear-gradient(rgba(11,60,93,0.85),rgba(11,60,93,0.85)),
    url("https://upload.wikimedia.org/wikipedia/commons/8/88/Michigan_State_Capitol_exterior.jpg")
    center/cover no-repeat;
    color:#fff;padding:6rem 2rem;
}
.hero-inner{max-width:900px;margin:auto}
.hero h1{font-size:3rem;margin-bottom:1rem}

/* FILTER BAR DESIGN */
.filter-bar{
  max-width:1200px;
  margin:2rem auto;
  padding:0 2rem;
}

.filter-inner{
  display:flex;
  flex-wrap:wrap;
  gap:12px;
  align-items:center;
  background:#f4f6f8;
  padding:14px 16px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.filter-inner input,
.filter-inner select{
  padding:10px 14px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:0.95rem;
  transition:all 0.2s;
}

.filter-inner input:focus,
.filter-inner select:focus{
  outline:none;
  border-color:var(--secondary);
  box-shadow:0 0 0 2px rgba(29,111,165,0.2);
}

.filter-inner input[type="number"]{
  width:100px;
}

.filter-inner select{
  background:#fff;
  cursor:pointer;
}



/* RESULTS */
.results-wrapper{
    max-width:1200px;margin:auto;
    padding:0 2rem 3rem 2rem;
}

.bill-row{
    background:#fff;padding:1.5rem;
    border-radius:12px;margin-bottom:1rem;
    box-shadow:0 8px 20px rgba(0,0,0,0.06);
    cursor:pointer;transition:0.2s;
}
.bill-row:hover{
    transform:translateY(-3px);
    box-shadow:0 12px 28px rgba(0,0,0,0.1);
}
.bill-row.active{
    border:2px solid var(--secondary);
}

.bill-top{
    display:flex;justify-content:space-between;
    margin-bottom:0.5rem;
}
.bill-id{
    font-weight:700;color:var(--primary);
}
.badge{
    background:var(--secondary);color:#fff;
    padding:4px 10px;border-radius:999px;
    font-size:12px;
}
.bill-title{font-weight:600}
.bill-desc{color:var(--muted);font-size:0.9rem}

/* DETAIL */
.detail-section{
    margin-top:2rem;background:#fff;
    padding:2rem;border-radius:12px;
    box-shadow:0 10px 30px rgba(0,0,0,0.08);
    display:none;position:relative;
}
.detail-section.active{display:block;animation:fadeIn .25s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1}}

.close-btn{
    position:absolute;top:20px;right:20px;
    cursor:pointer;font-weight:600;color:var(--muted);
}

.detail-number{
    font-size:1.4rem;font-weight:700;
    color:var(--primary);
}
.detail-name{
    font-size:1.1rem;font-weight:600;
    margin:6px 0 1.25rem;
}

.detail-meta{
    display:flex;gap:2.5rem;
    margin-bottom:1.5rem;
    font-weight:600;color:var(--secondary);
}

/* TRACKER */
.tracker{
    display:flex;
    justify-content:space-between;
    margin:2rem 0;
    position:relative;
}
.tracker::before{
    content:"";
    position:absolute;
    top:18px;left:0;right:0;
    height:3px;background:#e5e7eb;
}
.step{
    position:relative;
    text-align:center;
    flex:1;
}
.step .dot{
    width:36px;height:36px;
    border-radius:50%;
    background:#e5e7eb;
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    z-index:2;
    position:relative;
}
.step.complete .dot{
    background:var(--success);
    color:#fff;
}
.step.active .dot{
    background:var(--secondary);
    color:#fff;
}
.step-label{
    margin-top:8px;
    font-size:0.85rem;
    font-weight:600;
}

/* DOCUMENTS */
.documents a{
    display:block;margin-bottom:6px;
    font-weight:600;color:var(--secondary);
    text-decoration:none;
}

/* TIMELINE */
.timeline{
    margin-top:1rem;
    border-left:3px solid #e5e7eb;
    padding-left:35px;
}
.timeline-item{
    margin-bottom:18px;
    position:relative;
}
.timeline-item::before{
    content:"";
    position:absolute;
    left:-23px;top:6px;
    width:12px;height:12px;
    border-radius:50%;
    background:#cbd5e1;
}
.timeline-item.recent::before{
    background:var(--secondary);
}

/* TERMINAL TRACKER */
.terminal-tracker{
    display:flex;
    align-items:center;
    justify-content:space-between;
    margin:2rem 0;
    position:relative;
}

.terminal-tracker::before{
    content:"";
    position:absolute;
    top:18px;
    left:0;
    right:0;
    height:3px;
    background:#fecaca;
}

.terminal-step{
    position:relative;
    flex:1;
    text-align:center;
}

.terminal-dot{
    width:36px;
    height:36px;
    border-radius:50%;
    background:#dc2626;
    color:#fff;
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    z-index:2;
    position:relative;
}

.terminal-step.complete .terminal-dot{
    background:#16a34a;
}

.terminal-label{
    margin-top:8px;
    font-size:0.85rem;
    font-weight:700;
    color:#7f1d1d;
}

footer{
    background:var(--primary);
    color:#fff;padding:2rem;
    margin-top:3rem;text-align:center;
}
</style>
</head>

<body>

<header>
<div class="header-inner">
<div class="logo">Michigan Legislature</div>
<nav>
<a href="https://miservices.github.io/legislature/">Home</a>
<a href="https://miservices.github.io/legislature/about">About</a>
<a href="https://miservices.github.io/legislature/mcl">Laws</a>
<a href="https://miservices.github.io/legislature/bills" class="active">Bills</a>
<a href="https://miservices.github.io/legislature/resolutions">Resolutions</a>
<a href="https://miservices.github.io/legislature/journals">Journals</a>
</nav>
</div>
</header>

<section class="hero">
<div class="hero-inner">
<h1>Legislative Bills</h1>
<p>Search and explore legislation introduced in the Michigan Legislature.</p>
</div>
</section>

<div class="filter-bar">
  <div class="filter-inner">
    <input id="search" placeholder="Search bills..." oninput="applyFilters()">

    <select id="filterStatus" onchange="applyFilters()">
      <option value="">All Status</option>
      <option value="introduced">Introduced</option>
      <option value="second chamber">Second Chamber</option>
      <option value="awaiting governor">Awaiting Governor</option>
      <option value="enacted">Enacted</option>
      <option value="tabled">Tabled</option>
      <option value="defeated">Defeated</option>
      <option value="repealed">Repealed</option>
    </select>

    <select id="filterChamber" onchange="applyFilters()">
      <option value="">All Chambers</option>
      <option value="senate">Senate</option>
      <option value="house">House</option>
    </select>
  </div>
</div>


<div class="results-wrapper">
<div id="results"></div>
<div id="detailSection" class="detail-section"></div>
</div>

<footer>© 2026 Michigan Legislature</footer>

<script>
let billsData=[];
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ31EfUU7mCQYrcQAhNTKXey6ep6f6rACOykAkPa2FIfQtAN3iRgPxumI-3AdcyYKZUVoIpuI0NDnJL/pub?gid=0&single=true&output=csv";

document.addEventListener("DOMContentLoaded",()=>{
Papa.parse(CSV_URL,{
download:true,header:true,skipEmptyLines:true,
complete:res=>{
billsData=res.data.filter(b=>b["Bill No"]);
renderResults(billsData);
handleHash();
}
});
window.addEventListener("hashchange",handleHash);
});

function normalizeId(t){return t.toLowerCase().replace(/\s+/g,"")}

function formatNumber(b){
const s=(b["Status"]||"").toLowerCase();
if((s.includes("enacted")||s.includes("repealed"))&&b["PA No"])
return `PA ${b["PA No"]} | ${b["Bill No"]}`;
return b["Bill No"];
}

function normalizeSearch(text=""){
return text
.toLowerCase()
.replace(/[^a-z0-9]/g,"")
}

function billNumberVariants(billNo=""){
const n=billNo.toLowerCase();
return [
n,
n.replace(/\s+/g,""),
n.replace("senate bill","sb"),
n.replace("house bill","hb")
];
}


function applyFilters(){
  const query=document.getElementById("search").value.trim().toLowerCase();
  const statusFilter=document.getElementById("filterStatus").value.toLowerCase();
  const chamberFilter=document.getElementById("filterChamber").value.toLowerCase();

  const terms=query.split(/\s+/).filter(Boolean);

  const scored=billsData.map(b=>{
    let score=0;

    const billNo=b["Bill No"]||"";
    const name=b["Name"]||"";
    const desc=b["Description"]||"";
    const status=b["Status"]||"";
    const chamber=b["Intro Chamber"]||"";

    /* ---- ADVANCED FILTERS ---- */
    if(statusFilter && status.toLowerCase() !== statusFilter) return {...b, _score:0};
    if(chamberFilter && !chamber.toLowerCase().includes(chamberFilter)) return {...b, _score:0};

    const billNorm=normalizeSearch(billNo);
    const nameNorm=normalizeSearch(name);
    const descNorm=normalizeSearch(desc);

    /* ---- BILL NUMBER MATCH (HIGHEST PRIORITY) ---- */
    billNumberVariants(billNo).forEach(v=>{
      if(normalizeSearch(v).includes(normalizeSearch(query))) score+=100;
    });

    /* ---- TERM MATCHING ---- */
    terms.forEach(t=>{
      const nt=normalizeSearch(t);
      if(billNorm.includes(nt)) score+=40;
      if(nameNorm.includes(nt)) score+=20;
      if(descNorm.includes(nt)) score+=5;
    });

    /* ---- EXACT PHRASE BONUS ---- */
    if(normalizeSearch(name).includes(normalizeSearch(query))) score+=30;
    if(normalizeSearch(desc).includes(normalizeSearch(query))) score+=10;

    return {...b, _score:score};
  })
  .filter(b=>b._score>0)
  .sort((a,b)=>b._score-a._score);

  renderResults(scored);
}



function renderResults(data){
results.innerHTML="";
data.forEach(b=>{
const r=document.createElement("div");
r.className="bill-row";
r.dataset.id=normalizeId(b["Bill No"]);
r.onclick=()=>location.hash=r.dataset.id;
r.innerHTML=`
<div class="bill-top">
<div class="bill-id">${formatNumber(b)}</div>
<div class="badge">${b["Status"]||"—"}</div>
</div>
<div class="bill-title">${b["Name"]||""}</div>
<div class="bill-desc">${b["Description"]||""}</div>`;
results.appendChild(r);
});
}

function handleHash(){
const id=location.hash.slice(1);
if(!id){
detailSection.classList.remove("active");
return;
}
const bill=billsData.find(b=>normalizeId(b["Bill No"])===id);
if(bill) showDetail(bill);
}

function trackerHTML(b){
const status=(b["Status"]||"").toLowerCase();
const intro=(b["Intro Chamber"]||"").toLowerCase();

const origin=intro.includes("senate")?"Senate":"House";
const second=origin==="Senate"?"House":"Senate";

/* ---------- TERMINAL STATES ---------- */

if(status==="tabled"){
return `
<div class="terminal-tracker">
<div class="terminal-step complete">
<div class="terminal-dot">✓</div>
<div class="terminal-label">Introduced</div>
</div>

<div class="terminal-step">
<div class="terminal-dot">✖</div>
<div class="terminal-label">Tabled</div>
</div>
</div>
`;
}

if(status==="defeated"){
return `
<div class="terminal-tracker">
<div class="terminal-step complete">
<div class="terminal-dot">✓</div>
<div class="terminal-label">Introduced</div>
</div>

<div class="terminal-step">
<div class="terminal-dot">✖</div>
<div class="terminal-label">Defeated</div>
</div>
</div>
`;
}

if(status==="repealed"){
return `
<div class="terminal-tracker">
<div class="terminal-step complete">
<div class="terminal-dot">✓</div>
<div class="terminal-label">Became Law</div>
</div>

<div class="terminal-step">
<div class="terminal-dot">✖</div>
<div class="terminal-label">Repealed</div>
</div>
</div>
`;
}

/* ---------- NORMAL FLOW ---------- */

let activeStep=-1;
let completedUpTo=-1;
let secondLabel=`Passed ${second}`;

if(status==="introduced"){
activeStep=0;
}
else if(status==="second chamber"){
completedUpTo=1;
activeStep=2;
secondLabel=`In ${second}`;
}
else if(status==="awaiting governor"){
completedUpTo=2;
activeStep=3;
}
else if(status==="enacted"){
completedUpTo=4;
}


const steps=[
"Introduced",
`Passed ${origin}`,
secondLabel,
"Awaiting Governor",
status==="enacted" ? "Is Law" : "Became Law"
];


return `
<div class="tracker">
${steps.map((s,i)=>{
let cls="step";
if(i<=completedUpTo) cls+=" complete";
if(i===activeStep) cls+=" active";
return `
<div class="${cls}">
<div class="dot">${i+1}</div>
<div class="step-label">${s}</div>
</div>`;
}).join("")}
</div>
`;
}




function showDetail(b){
document.querySelectorAll(".bill-row").forEach(r=>r.classList.remove("active"));
document.querySelector(`[data-id="${normalizeId(b["Bill No"])}"]`)?.classList.add("active");

const historyItems=b["History"]
?b["History"].split("|").map(h=>h.trim()).filter(Boolean)
:[];

detailSection.innerHTML=`
<div class="close-btn" onclick="closeDetail()">Close</div>

<div class="detail-number">${formatNumber(b)}</div>
<div class="detail-name">${b["Name"]||""}</div>

<div class="detail-meta">
<div>${b["Sponsors"]||"—"}</div>
</div>

${trackerHTML(b)}

<div class="detail-description">${b["Description"]||""}</div>

<h3>Documents</h3>
<div class="documents">${renderDocs(b)}</div>

<h3 style="margin-top:2rem;">Legislative Timeline</h3>
<div class="timeline">
${historyItems.length?historyItems.map((h,i)=>`
<div class="timeline-item ${i===historyItems.length-1?"recent":""}">${h}</div>
`).join(""):"No history available."}
</div>`;
detailSection.classList.add("active");
detailSection.scrollIntoView({behavior:"smooth"});
}

function renderDocs(b){
const l=[];
if(b["Intro PDF"]) l.push(`<a href="${b["Intro PDF"]}" target="_blank">Introduced Bill.pdf</a>`);
if(b["Concurred PDF"]) l.push(`<a href="${b["Concurred PDF"]}" target="_blank">Concurred Bill.pdf</a>`);
if(b["PA PDF"]) l.push(`<a href="${b["PA PDF"]}" target="_blank">Public Act.pdf</a>`);
return l.length?l.join(""):"No documents available.";
}

function closeDetail(){
detailSection.classList.remove("active");
window.history.pushState("",document.title,location.pathname);
}
</script>

</body>
</html>
