<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Michigan Legislature – Michigan Compiled Laws</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* === YOUR ORIGINAL STYLES (UNCHANGED) === */
:root {
    --primary: #0b3c5d;
    --secondary: #1d6fa5;
    --accent: #e0b400;
    --light: #f4f6f8;
    --dark: #1a1a1a;
    --border: #d6dde5;
}

* { box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI",Arial,sans-serif; }
body { background:var(--light);color:var(--dark);line-height:1.6; }

header { background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:1.25rem 2rem; }
.header-inner { max-width:1200px;margin:auto;display:flex;justify-content:space-between;align-items:center; }
.logo { font-size:1.6rem;font-weight:700; }

nav a { color:#ffffffcc;text-decoration:none;margin-left:1.5rem;font-weight:500; }
nav a.active { color:#fff;border-bottom:3px solid var(--accent); }

.hero {
    background:
    linear-gradient(rgba(11,60,93,0.85),rgba(11,60,93,0.85)),
    url("https://upload.wikimedia.org/wikipedia/commons/8/88/Michigan_State_Capitol_exterior.jpg")
    center/cover no-repeat;
    color:#fff;padding:4.5rem 2rem;
}
.hero-inner { max-width:900px;margin:auto; }
.hero h1 { font-size:3rem; }
.hero p { margin-top:0.75rem;font-size:1.15rem; }

main { max-width:1200px;margin:3rem auto;padding:0 2rem; }

.chapter { background:#fff;border-radius:10px;margin-bottom:1.25rem;
box-shadow:0 6px 18px rgba(0,0,0,0.08);overflow:hidden; }

.chapter-header { padding:1.25rem 1.5rem;cursor:pointer;
display:flex;justify-content:space-between;font-weight:600; }
.chapter-header:hover { background:#f1f4f8; }

.toggle { font-size:1.4rem;color:var(--secondary); }
.sections { display:none;border-top:1px solid var(--border); }

.section-item { padding:0.85rem 1.75rem;border-top:1px solid var(--border);cursor:pointer; }
.section-item:hover { background:#f7f9fc; }
.section-item span { font-weight:700;color:var(--secondary); }

.section-view { background:#fff;border-radius:12px;padding:2.5rem;
box-shadow:0 8px 22px rgba(0,0,0,0.08); }

.section-view h2 { color:var(--primary);font-size:2rem;margin-bottom:0.5rem; }
.back-btn { margin-bottom:1.25rem;display:inline-block;color:var(--secondary);
font-weight:600;text-decoration:none; }

.section-text { margin-top:1.5rem; }
.section-text .heading { font-weight:700;margin-bottom:0.75rem;font-size:1.05rem; }

footer { background:var(--primary);color:#fff;padding:2rem;margin-top:5rem; }
.footer-inner { max-width:1200px;margin:auto;display:flex;
justify-content:space-between;font-size:0.9rem; }
</style>
</head>

<body>

<header>
<div class="header-inner">
<div class="logo">Michigan Legislature</div>
<nav>
<a href="https://miservices.github.io/legislature/">Home</a>
<a href="https://miservices.github.io/legislature/about">About</a>
<a class="active" href="#">Laws</a>
<a href="#">Bills</a>
<a href="#">Resolutions</a>
<a href="#">Journals</a>
</nav>
</div>
</header>

<section class="hero">
<div class="hero-inner">
<h1>Michigan Compiled Laws</h1>
<p>Complete statutory laws of the State of Michigan.</p>
</div>
</section>

<main id="laws"></main>

<footer>
<div class="footer-inner">
<div>© 2026 Michigan Legislature</div>
<div>Official State of Michigan Website</div>
</div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQaZtiF885qU65kN8IttJzYV8NcCiBFYI0Pn8z27HG8owEIiAeI2W4eg0r2Rpd-rdjVmMJXiKINu-gt/pub?output=csv";

let sections={},chapters={},orderedSections=[];

async function init(){
try{
const r=await fetch(CSV_URL);
const text=await r.text();
parseCSV(text);
}catch(e){
document.getElementById("laws").innerHTML="<p style='color:red'>Failed to load data.</p>";
console.error(e);
}
}

function parseCSV(text){
const rows=[];let row=[],cell="",q=false;
for(let i=0;i<text.length;i++){
const c=text[i],n=text[i+1];
if(c=='"'&&n=='"'){cell+='"';i++}
else if(c=='"')q=!q;
else if(c==','&&!q){row.push(cell);cell=""}
else if((c=='\n'||c=='\r')&&!q){
if(cell||row.length){row.push(cell);rows.push(row);row=[];cell=""}
}else cell+=c;
}
if(cell||row.length){row.push(cell);rows.push(row)}

rows.slice(1).forEach(r=>{
const cite = r[0]?.trim();
const type = r[1]?.trim()?.toLowerCase();
const title = r[2]?.trim();
const act = r[3]?.trim();        // COLUMN D (Act)
const desc = r[4]?.trim();
const history = r[5]?.trim();
if(!cite||!type)return;

if(type==="chapter")chapters[cite]={cite,title};
if(type==="section"){
sections[cite] = { cite, title, act, desc, history };
orderedSections.push(cite);
}
});
orderedSections.sort((a,b)=>parseFloat(a)-parseFloat(b));
route();
}

function route(){
const root=document.getElementById("laws");
root.innerHTML="";
const h=location.hash.replace("#","");
if(!h)buildChapters();
else if(h.includes("."))openSection(h);
else buildChapters(h);
}

function buildChapters(open=null){
const root=document.getElementById("laws");
Object.values(chapters).forEach(ch=>{
const box=document.createElement("div");
box.className="chapter";

const header=document.createElement("div");
header.className="chapter-header";
header.innerHTML=`Chapter ${ch.cite} — ${ch.title}
<span class="toggle">${open==ch.cite?"−":"+"}</span>`;
header.onclick=()=>location.hash=ch.cite;

const list=document.createElement("div");
list.className="sections";

if(open==ch.cite){
list.style.display="block";
orderedSections
.filter(s=>s.startsWith(ch.cite+"."))
.forEach(s=>{
if(!sections[s])return;
const item=document.createElement("div");
item.className="section-item";
item.innerHTML=`<span>${s}</span> — ${sections[s].title}`;
item.onclick=()=>location.hash=s;
list.appendChild(item);
});
}
box.appendChild(header);
box.appendChild(list);
root.appendChild(box);
});
}

function openSection(cite){
const s=sections[cite];
if(!s)return;
const root=document.getElementById("laws");
root.innerHTML="";
const ch=cite.split(".")[0];

const view=document.createElement("div");
view.className="section-view";
view.innerHTML=`
<a class="back-btn" href="#${ch}">← Back to Chapter ${ch}</a>
<h2>MCL ${cite}</h2>
<a href="#" onclick="printSection('${cite}');return false;"
style="color:var(--secondary);font-weight:600;">Print as PDF</a>
<div class="section-text"></div>
`;
const textDiv=view.querySelector(".section-text");

const heading = document.createElement("div");
heading.className = "heading";
heading.textContent = s.title || "";
textDiv.appendChild(heading);

if(s.act){
    const actDiv = document.createElement("div");
    actDiv.style.marginTop = "6px";
    actDiv.style.fontWeight = "600";
    actDiv.style.color = "var(--secondary)";
    actDiv.textContent = s.act.toUpperCase();
    textDiv.appendChild(actDiv);
}

(s.desc||"").split(/\r?\n/).map(l=>l.trim())
.filter(l=>l).forEach(line=>{
const p=document.createElement("div");
p.style.margin="6px 0";
p.textContent=line;
textDiv.appendChild(p);
});

if(s.history){
const hDiv=document.createElement("div");
hDiv.style.marginTop="20px";
hDiv.style.fontSize="0.9rem";
hDiv.innerHTML=`<strong>History:</strong> ${s.history}`;
textDiv.appendChild(hDiv);
}

root.appendChild(view);
}

function printSection(cite){
if(!window.jspdf)return alert("PDF library not loaded");
const { jsPDF }=window.jspdf;
const s=sections[cite]; if(!s)return;

const doc=new jsPDF();
doc.text(`MCL ${cite}`,10,10);
doc.text(s.title||"",10,20);
doc.text(s.desc||"",10,30);
if(s.history)doc.text("History: "+s.history,10,40);
doc.save(`MCL_${cite}.pdf`);
}

window.addEventListener("hashchange",route);
window.addEventListener("load",init);
</script>

</body>
</html>

