<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Michigan Legislature – Michigan Compiled Laws</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --bg: #061423;
    --bg2: #0b1e33;
    --primary: #4da3ff;
    --text: #ffffff;
    --muted: #b7c6d9;
    --border: #1e3550;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: "Segoe UI", Arial, sans-serif;
}

body {
    background: linear-gradient(180deg, var(--bg), var(--bg2));
    color: var(--text);
}

header {
    text-align: center;
    padding: 1.75rem 1rem 1rem;
}

header h1 {
    font-size: 2.2rem;
}

header p {
    margin-top: 0.5rem;
    font-size: 0.95rem;
    color: var(--muted);
}

main {
    max-width: 1100px;
    margin: 2.5rem auto;
    padding: 0 2rem;
}

.chapter {
    border: 1px solid var(--border);
    margin-bottom: 1rem;
}

.chapter-header {
    padding: 1rem 1.25rem;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
}

.chapter-header:hover {
    background: rgba(255,255,255,0.04);
}

.chapter-title {
    font-size: 1.05rem;
    font-weight: 600;
}

.toggle {
    font-size: 1.3rem;
}

.sections {
    display: none;
    border-top: 1px solid var(--border);
}

.section-item {
    padding: 0.75rem 1.25rem;
    border-top: 1px solid var(--border);
    cursor: pointer;
}

.section-item:hover {
    background: rgba(255,255,255,0.05);
}

.section-item span {
    color: var(--primary);
    font-weight: 600;
}

.section-view {
    margin-top: 3rem;
    border-top: 2px solid var(--border);
    padding-top: 2.5rem;
}

.section-view h2 {
    font-size: 2rem;
}

.section-text {
    margin-top: 1.5rem;
    white-space: pre-wrap;
    line-height: 1.75;
}

.section-text .heading {
    font-weight: 700;
    margin-bottom: 0.75rem;
}

.nav-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 3rem;
}

.nav-buttons button {
    background: none;
    border: 1px solid var(--border);
    color: var(--primary);
    padding: 0.75rem 1.5rem;
    cursor: pointer;
    font-size: 0.95rem;
}

.nav-buttons button:hover {
    background: rgba(255,255,255,0.05);
}

footer {
    margin-top: 5rem;
    padding: 2rem;
    text-align: center;
    font-size: 0.85rem;
    color: var(--muted);
}
</style>
</head>

<body>

<header>
    <h1>Michigan Legislature</h1>
    <p>Michigan Compiled Laws Complete Through PA 2 of 2026</p>
</header>

<main id="laws"></main>

<footer>
    © 2026 Michigan Legislature — Official State of Michigan Website
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const { jsPDF } = window.jspdf;

const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQaZtiF885qU65kN8IttJzYV8NcCiBFYI0Pn8z27HG8owEIiAeI2W4eg0r2Rpd-rdjVmMJXiKINu-gt/pub?output=csv";

let sections = {};
let chapters = {};
let orderedSections = [];

fetch(CSV_URL)
    .then(r => r.text())
    .then(parseCSV);

function cleanText(text) {
    return text
        .replace(/\r/g, "")
        .replace(/^\s+/, "")
        .replace(/\n\s+/g, "\n")
        .trim();
}

function parseCSV(text) {
    const rows = text.split(/\r?\n/);

    rows.slice(1).forEach(row => {
        if (!row.trim()) return;

        const cols = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
        if (!cols) return;

        const cleaned = cols.map(c =>
            c.replace(/^"|"$/g, "").replace(/""/g, '"').trim()
        );

        const citation = cleaned[0];
        const type = cleaned[1];
        const title = cleaned[2];
        const act = cleaned[3];
        const desc = cleanText(cleaned.slice(4).join(","));

        if (type?.toLowerCase() === "chapter") {
            chapters[citation] = { citation, title };
        }

        if (type?.toLowerCase() === "section") {
            sections[citation] = { citation, title, act, desc };
            orderedSections.push(citation);
        }
    });

    orderedSections.sort((a, b) => {
        const [aC, aS] = a.split(".").map(Number);
        const [bC, bS] = b.split(".").map(Number);
        return aC !== bC ? aC - bC : aS - bS;
    });

    route();
}

function route() {
    const root = document.getElementById("laws");
    root.innerHTML = "";

    const hash = location.hash.replace("#", "");

    if (!hash) buildChapters();
    else if (hash.includes(".")) {
        buildChapters(hash.split(".")[0]);
        openSection(hash);
    } else buildChapters(hash);
}

function buildChapters(openCh = null) {
    const root = document.getElementById("laws");

    Object.values(chapters).forEach(ch => {
        const chap = document.createElement("div");
        chap.className = "chapter";

        const header = document.createElement("div");
        header.className = "chapter-header";
        header.innerHTML = `
            <div class="chapter-title">
                Chapter ${ch.citation} — ${ch.title}
            </div>
            <div class="toggle">${openCh === ch.citation ? "−" : "+"}</div>
        `;
        header.onclick = () => location.hash = ch.citation;

        const list = document.createElement("div");
        list.className = "sections";

        if (openCh === ch.citation) {
            list.style.display = "block";

            orderedSections
                .filter(s => s.startsWith(ch.citation + "."))
                .forEach(s => {
                    const item = document.createElement("div");
                    item.className = "section-item";
                    item.innerHTML = `<span>§ ${s}</span> — ${sections[s].title}`;
                    item.onclick = () => location.hash = s;
                    list.appendChild(item);
                });
        }

        chap.appendChild(header);
        chap.appendChild(list);
        root.appendChild(chap);
    });
}

function openSection(cite) {
    const root = document.getElementById("laws");
    const s = sections[cite];
    if (!s) return;

    const idx = orderedSections.indexOf(cite);
    const prev = idx > 0 ? orderedSections[idx - 1] : null;
    const next = idx < orderedSections.length - 1 ? orderedSections[idx + 1] : null;

    const view = document.createElement("div");
    view.className = "section-view";
    view.innerHTML = `
        <h2>MCL § ${s.citation}</h2>

        <div style="margin-top:8px;">
            <a href="#" onclick="printSection('${cite}'); return false;"
               style="color: var(--primary); font-size: 0.95rem;">
                Print this section as PDF
            </a>
        </div>

        <div class="section-text">
            <div class="heading">${s.citation} ${s.title}</div>
${s.desc}
        </div>

        <div class="nav-buttons">
            ${prev ? `<button onclick="location.hash='${prev}'">← Previous § ${prev}</button>` : `<span></span>`}
            ${next ? `<button onclick="location.hash='${next}'">Next § ${next} →</button>` : `<span></span>`}
        </div>
    `;

    root.appendChild(view);
}

function printSection(cite) {
    const s = sections[cite];
    if (!s) return;

    const doc = new jsPDF({ unit: "pt", format: "letter" });
    const margin = 72;
    const maxWidth = doc.internal.pageSize.getWidth() - margin * 2;
    let y = margin;

    doc.setFont("times", "bold");
    doc.setFontSize(14);
    doc.text("Michigan Compiled Laws", margin, y);
    y += 24;

    doc.text(`${s.citation} ${s.title}`, margin, y);
    y += 20;

    doc.setFont("times", "normal");
    doc.setFontSize(11);

    const lines = doc.splitTextToSize(s.desc, maxWidth);
    lines.forEach(line => {
        if (y > 720) {
            doc.addPage();
            y = margin;
        }
        doc.text(line, margin, y);
        y += 15;
    });

    doc.save(`MCL_${s.citation}.pdf`);
}

window.addEventListener("hashchange", route);
window.addEventListener("load", route);
</script>

</body>
</html>
